# youngjin_terraform

Terraformì„ ì´ìš©í•´ AWS ê¸°ë°˜ ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ì •ì˜í•˜ê³ , ë‹¤ì–‘í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ëª¨ë“ˆí™”í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ì˜ˆì œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.  
EKS, EC2, RDS, Redis, S3, Karpenter, ELB, NAT, VPC ë“± ì£¼ìš” ë¦¬ì†ŒìŠ¤ë¥¼ í¬í•¨í•˜ë©°, êµ¬ì„±ì— ë”°ë¼ ë¶€ë¶„ì  í™œì„±í™”/ë¹„í™œì„±í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ğŸ“¦ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
.
â”œâ”€â”€ main.tf                   # ì „ì²´ êµ¬ì„± ì§„ì…ì 
â”œâ”€â”€ aws.tf                   # AWS Provider ì •ì˜
â”œâ”€â”€ backend.tf               # Terraform Cloud Backend ì •ì˜
â”œâ”€â”€ variables.tf             # ì „ì—­ ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ ap_south_1/              # ë­„ë°”ì´ ë¦¬ì „ ë¦¬ì†ŒìŠ¤ êµ¬ì„±
â”‚   â”œâ”€â”€ eks/                 # EKS í´ëŸ¬ìŠ¤í„°, Karpenter, ë…¸ë“œê·¸ë£¹
â”‚   â”œâ”€â”€ ec2/                 # Bastion EC2
â”‚   â”œâ”€â”€ rds/                 # Aurora MySQL RDS
â”‚   â”œâ”€â”€ redis/               # Redis Cluster
â”‚   â”œâ”€â”€ efs/                 # Elastic File System
â”‚   â”œâ”€â”€ s3/                  # ì¼ë°˜ ë²„í‚· + Velero ë°±ì—…ìš© S3
â”‚   â”œâ”€â”€ iam/                 # ê°ì¢… IAM Role/User/Profile
â”‚   â”œâ”€â”€ security_groups/     # Redis, Bastion, ALBìš© SG
â”‚   â”œâ”€â”€ elb/                 # ALB (Application Load Balancer)
â”‚   â”œâ”€â”€ igw/, nat/, eip/     # ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¦¬ì†ŒìŠ¤
â”‚   â”œâ”€â”€ subnets/, route_table/  # ì„œë¸Œë„·, ë¼ìš°íŒ… í…Œì´ë¸”
â”‚   â””â”€â”€ endpoint/            # (ì˜µì…˜) VPC Endpoint
```

---

## âš™ï¸ ì£¼ìš” ê¸°ëŠ¥

- ëª¨ë“ˆí™”ëœ AWS ì¸í”„ë¼ êµ¬ì„±: VPC, ì„œë¸Œë„·, NAT, IGW, EIP, ë³´ì•ˆ ê·¸ë£¹ ë“±
- EKS + Karpenter:
  - EKS í´ëŸ¬ìŠ¤í„° ìƒì„±
  - Karpenterë¥¼ í†µí•œ ìŠ¤íŒŸ ê¸°ë°˜ ì›Œì»¤ë…¸ë“œ ìë™ ì¦ì„¤ ë° ì œê±°
- EC2 Bastion ì„œë²„: SSM ì—°ê²°ì„ ìœ„í•œ ì—­í•  ìë™ ìƒì„±
- RDS, Redis, EFS: ì£¼ì„ í•´ì œ í›„ ì†ì‰½ê²Œ í™œì„±í™” ê°€ëŠ¥
- S3 + Velero ë°±ì—… êµ¬ì¡°
- Terraform Cloud ì—°ë™
- Security Group ë¶„ë¦¬ ê´€ë¦¬: Redis/ALB/Bastion ë³„ SG ëª¨ë“ˆ êµ¬ì„±

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1. ìš”êµ¬ì‚¬í•­

- Terraform CLI 1.3 ì´ìƒ
- AWS ê³„ì • & ì ì ˆí•œ IAM ê¶Œí•œ
- Terraform Cloud ê³„ì • (ë°±ì—”ë“œ ì‚¬ìš© ì‹œ)

### 2. ì´ˆê¸° ì„¤ì •

```bash
git clone https://github.com/PYJ-zero/youngjin_terraform.git
cd youngjin_terraform
terraform init
```

- `variables.tf` ë˜ëŠ” `.tfvars`ì—ì„œ `project_name`, `region_code` ì„¤ì •
- `backend.tf`ì— ë³¸ì¸ì˜ Terraform Cloud org/workspace ì„¤ì •

---

## â˜ï¸ êµ¬ì„± í™œì„±í™” íŒ

- RDS, Redis, EFS, Endpoint, ELB ë“±ì€ ê¸°ë³¸ì ìœ¼ë¡œ ì£¼ì„ ì²˜ë¦¬ë˜ì–´ ìˆìŒ
- `ap_south_1/ap_south_1_main.tf` ë‚´ ì£¼ì„ì„ í•´ì œí•˜ê³  í•„ìš” ë³€ìˆ˜ ì±„ì›Œì„œ í™œì„±í™” ê°€ëŠ¥
- ê° ëª¨ë“ˆì€ `source = ./<ëª¨ë“ˆ ë””ë ‰í† ë¦¬>` í˜•íƒœë¡œ êµ¬ì¡°í™”ë˜ì–´ ìˆìŒ

---

---

## âš ï¸ ìš´ì˜ ì‹œ ì°¸ê³ ì‚¬í•­ ë° ê¸°ìˆ ì  ë©”ëª¨

ì´ ì„¹ì…˜ì€ ì´ í”„ë¡œì íŠ¸ì˜ ì‘ì„±ìê°€ Terraform ì½”ë“œ ì‘ì„± ë‹¹ì‹œ ê³ ë ¤í•œ **ì„¤ì • ì˜ë„, ë³´ì•ˆ ì£¼ì˜ì‚¬í•­, êµ¬ì„±ì˜ ë§¥ë½** ë“±ì„ ê¸°ì–µ ë³´ì¡´ ë° ìœ ì§€ë³´ìˆ˜ ëª©ì ìœ¼ë¡œ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

### ğŸ§± ëª¨ë“ˆ ì‚¬ìš© ì‹œ ê¸°ìˆ ì  ì£¼ì˜ì‚¬í•­

#### EKS & Karpenter

- `karpenter-node-role`ì€ ìˆ˜ë™ìœ¼ë¡œ ì§ì ‘ ì •ì˜í•˜ë©°, ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ ì •ì±…ì„ ëª…ì‹œì ìœ¼ë¡œ ë¶™ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤:
  - `AmazonEKSWorkerNodePolicy`
  - `AmazonEKS_CNI_Policy`
  - `AmazonEC2ContainerRegistryReadOnly`
  - `AmazonSSMManagedInstanceCore`
  - â¤ ë‚˜ì¤‘ì— EBS, S3, Spot ì¸í„°ëŸ½íŠ¸ ë“± ì—°ë™ ì‹œ `ec2:CreateTags`, `ec2:DescribeTags`, `autoscaling:*` ê¶Œí•œì´ ì¶”ê°€ì ìœ¼ë¡œ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Karpenterì˜ IAM ì—­í• ì€ `IRSA` ë°©ì‹ì´ ì•„ë‹Œ EC2ì— ì§ì ‘ ë¶™ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
  - â¤ IRSAë¡œ ì „í™˜í•  ê²½ìš° trust policy ë° oidc ì„¤ì •ì„ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

- `ttlSecondsAfterEmpty`, `consolidation` ê°™ì€ ë…¸ë“œ ìë™ ì •ë¦¬ ì„¤ì •ì€ í˜„ì¬ ì½”ë“œì— ëª…ì‹œì ìœ¼ë¡œ ì •ì˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.
  - â¤ Helm Chartì˜ `values.yaml`ì—ì„œ ê´€ë¦¬í•˜ê³  ìˆì„ ê°€ëŠ¥ì„± ë†’ìœ¼ë©°, Terraformí™”ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Addons ì„¤ì¹˜

- EKS `vpc-cni`, `kube-proxy`, `coredns` ë“±ì€ Terraformìœ¼ë¡œ ì„¤ì¹˜ë©ë‹ˆë‹¤.
  - â¤ Addon ë²„ì „ ê³ ì • í•„ìˆ˜. ì¶”í›„ EKS ìì²´ ìë™ ì—…ë°ì´íŠ¸ì™€ ì¶©ëŒì„ í”¼í•˜ë ¤ë©´ lifecycle ì œì–´ë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.
  - â¤ IRSAë¥¼ ì‚¬ìš©í•˜ëŠ” Addonì´ ìˆë‹¤ë©´, ê·¸ì— ë§ëŠ” IAM Role ì •ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤ (`trust_relationship`, `eks.amazonaws.com/serviceaccount` ì‚¬ìš©).

---

### ğŸ” ë³´ì•ˆ ê´€ë ¨ ì£¼ì˜ì‚¬í•­

#### Security Groups

- `alb_sg`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `0.0.0.0/0` IPì— `80`, `443` í¬íŠ¸ë¥¼ ì˜¤í”ˆí•©ë‹ˆë‹¤.
  - â¤ ê°œë°œ í™˜ê²½ìš©ìœ¼ë¡œëŠ” í—ˆìš©ë˜ë‚˜, ìš´ì˜ì—ì„œëŠ” WAF ì—°ë™ í˜¹ì€ CIDR ì œí•œ ê¶Œì¥

- Redis SGëŠ” `150.0.0.0/16`ì— ì—´ë ¤ ìˆìŒ:
  - â¤ ë‚´ë¶€ë§ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ, CIDR ì„¤ëª… ì£¼ì„ì„ ëª…ì‹œí•˜ê±°ë‚˜ READMEì— ê¸°ë¡í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

#### IAM Roles

- `ssm_role`ì—ëŠ” `AdministratorAccess`ê°€ ë¶™ì–´ ìˆìŒ:
  - â¤ Bastion ì„œë²„ë¥¼ ìœ„í•œ ê¸´ê¸‰ ì ‘ê·¼ìš©ì´ë¼ë„ ìµœì†Œ ê¶Œí•œ ì •ì±…ìœ¼ë¡œ ì¬ì„¤ê³„ í•„ìš”

- Nodeìš© IAM Rolesì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ EC2 ì‹¤í–‰ ê¶Œí•œë§Œ ì¡´ì¬í•˜ë©°, `tagging` ê¶Œí•œ ì—†ìŒ:
  - â¤ Karpenterê°€ EC2, ENI, EBS ë¦¬ì†ŒìŠ¤ë¥¼ íƒœê¹…/ì •ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì¶”ê°€ ê¶Œí•œ ë¶€ì—¬ ê¶Œì¥

---

### ğŸ› ï¸ ìœ ì§€ë³´ìˆ˜ìš© ë©”ëª¨

- `iam_role_karpenterNode.tf_` â† íŒŒì¼ëª… ëì— `_`ê°€ ë¶™ì€ ì´ìœ ëŠ” apply ì¶©ëŒ ë°©ì§€ë‚˜ ìˆ˜ë™ ë°±ì—… ì˜ë„, ì‚¬ìš© ì—¬ë¶€ í™•ì¸ í›„ ì •ë¦¬ í•„ìš”

- ALB ëª¨ë“ˆ ë‚´ì˜ `listener`, `target-group`, `listener-rule`ì´ ì£¼ì„ ì²˜ë¦¬ë¼ ìˆìŒ:
  - â¤ í”„ë¡œì íŠ¸ ì´ˆê¸°ì—” ALB í…ŒìŠ¤íŠ¸ë§Œ ëª©ì ì´ì—ˆê³ , ì¶”í›„ `/app/*` ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ… ë˜ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë„ì…ì„ ì˜ˆìƒí–ˆë˜ êµ¬ì¡°

---

### â˜ï¸ í´ë¼ìš°ë“œ êµ¬ì„± ë° ë¹„ìš© ê´€ë ¨

- NAT Gateway ë‹¤ì¤‘í™” êµ¬ì„± (ë³€ìˆ˜: `nat_eip`, `nat_subnets`)ì„ ì§€ì›í•¨:
  - â¤ ê°€ìš©ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ì„¤ê³„ì´ë‚˜, NAT ë¹„ìš©ì´ ì¦ê°€í•˜ë¯€ë¡œ í”„ë¡œë•ì…˜ ì™¸ í™˜ê²½ì—ì„œëŠ” ë‹¨ì¼ NATë¡œ ë³€ê²½ ê°€ëŠ¥

- RDS, Redis, EFS, Endpoint, ELB ë“±ì€ ëª¨ë‘ `ap_south_1_main.tf`ì—ì„œ ì£¼ì„ ì²˜ë¦¬ ìƒíƒœë¡œ ë¹„í™œì„±í™”ë¨:
  - â¤ í•„ìš” ì‹œ ì£¼ì„ í•´ì œ + `.tfvars` ì…ë ¥ë§Œìœ¼ë¡œ ì‰½ê²Œ í™œì„±í™” ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìŒ

---

## âœ… ìœ ì§€ê´€ë¦¬ìë¥¼ ìœ„í•œ ê¸°ì–µ íŠ¸ë¦¬ê±°

> ì´ í”„ë¡œì íŠ¸ëŠ” ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë¥¼ ëª¨ë“ˆí™”í–ˆìœ¼ë©°, ìƒì„± ìˆœì„œ, ì¢…ì†ì„±, ê¶Œí•œ ì²´ê³„ì— ëŒ€í•´ ì •êµí•˜ê²Œ ì„¤ê³„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.  
> í•´ë‹¹ ë¬¸ì„œëŠ” ìœ ì§€ë³´ìˆ˜ì ë˜ëŠ” ì‘ì„±ìì¸ ë‚´ê°€ ìˆ˜ê°œì›” í›„ì—ë„ ë‹¹ì‹œ ì„¤ê³„ë¥¼ ê¸°ì–µí•  ìˆ˜ ìˆë„ë¡ ì‘ì„±ëœ ì°¸ì¡°ìš© ì•ˆë‚´ì„œì…ë‹ˆë‹¤.

## ğŸ‘¤ ì‘ì„±ì

- Youngjin Park  
- GitHub: [PYJ-zero](https://github.com/PYJ-zero)